{
  # Log everything to stdout
  log {
    output stdout
    format console
    level DEBUG
  }

  # Run Bun with supervisor
  # https://caddyserver.com/docs/modules/supervisor
  supervisor {
    myserver {
      restart_policy always
      redirect_stdout stdout
      redirect_stderr stderr
    }
   }
}

:80 {
  redir https://{host}{uri} permanent
}

# Reverse proxy to Bun server running on port 3000

{$DOMAIN:localhost} {
  encode gzip
  header Access-Control-Allow-Origin "*"
  header Access-Control-Allow-Methods "GET, POST, OPTIONS, PUT, DELETE"
  header Access-Control-Allow-Headers "Content-Type, Authorization"

  reverse_proxy localhost:3000
}

# on the sever you should change localhost to your domain name
# and set up DNS to point to your server's IP address
# and open port 443 in your firewall for HTTPS traffic